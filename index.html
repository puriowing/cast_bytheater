<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAST 劇場別ダッシュボード</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Interフォントを適用 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 と同等 */
        }
        /* カスタムスクロールバー（フィードバック欄用） */
        .feedback-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .feedback-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .feedback-scroll::-webkit-scrollbar-thumb {
            background: #c5c5c5;
            border-radius: 10px;
        }
        .feedback-scroll::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        /* フィルターのセレクトボックスのスタイルを統一 */
        .header-select {
            background-color: #4a5568; /* bg-gray-700 */
            border: 1px solid #718096; /* bg-gray-500 */
            color: white;
            padding: 0.375rem 2rem 0.375rem 0.75rem; /* py-1.5 pl-3 pr-8 */
            border-radius: 0.375rem; /* rounded-md */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='m6 9 6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.25em 1.25em;
        }
        /* コメントフィルター用のボタンスタイル */
        .comment-filter-btn {
            padding: 0.375rem 0.75rem; /* py-1.5 px-3 */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            border: 1px solid #d1d5db; /* border-gray-300 */
            background-color: white;
            color: #374151; /* text-gray-700 */
            cursor: pointer;
        }
        .comment-filter-btn.active {
            background-color: #4F46E5; /* bg-indigo-600 */
            color: white;
            border-color: #4F46E5; /* border-indigo-600 */
            z-index: 10;
        }
        .comment-filter-btn:first-child {
            border-top-left-radius: 0.375rem; /* rounded-l-md */
            border-bottom-left-radius: 0.375rem;
        }
        .comment-filter-btn:last-child {
            border-top-right-radius: 0.375rem; /* rounded-r-md */
            border-bottom-right-radius: 0.375rem;
        }
        .comment-filter-btn:not(:first-child) {
            margin-left: -1px;
        }
        .comment-filter-btn:not(.active):hover {
            background-color: #f9fafb; /* bg-gray-50 */
        }
    </style>
</head>
<body class="antialiased">

    <!-- ヘッダー & フィルター -->
    <nav class="bg-gray-800 text-white p-4 shadow-md sticky top-0 z-10">
        <div class="container mx-auto flex flex-wrap items-center justify-between relative">
            <h1 class="text-xl font-bold">
                CAST 劇場別ダッシュボード
            </h1>
            <!-- 最終更新日時 -->
            <div class="text-xs text-gray-400 mt-1 md:mt-0 md:absolute md:left-1/2 md:-translate-x-1/2">
                最終更新: <span id="last-updated-time">2025/10/30 08:00</span>
            </div>
            <!-- フィルター群 -->
            <div class="flex flex-wrap items-center gap-4 mt-4 md:mt-0">
                <!-- シネコンフィルター (変更) -->
                <div class="flex items-center gap-2">
                    <label for="cineplex-filter" class="text-sm font-medium">シネコン:</label>
                    <select id="cineplex-filter" class="header-select text-sm">
                        <option value="cineplexA">Aシネマ</option>
                        <option value="cineplexB">Bシネマ</option>
                        <option value="cineplexC">Cシネコン</option>
                        <option value="cineplexD">Dシネコン</option>
                    </select>
                </div>
                <!-- 作品フィルター -->
                <div class="flex items-center gap-2">
                    <label for="work-filter" class="text-sm font-medium">作品:</label>
                    <select id="work-filter" class="header-select text-sm">
                        <option value="all">全作品（比較）</option>
                        <option value="sample-a">サンプル作品A（個別）</option>
                        <option value="sample-b">サンプル作品B（個別）</option>
                    </select>
                </div>
                <!-- 比較対象フィルター -->
                <div class="flex items-center gap-2">
                    <label for="benchmark-filter" class="text-sm font-medium">比較:</label>
                    <select id="benchmark-filter" class="header-select text-sm">
                        <option value="industry">業界平均</option>
                        <option value="company">自社平均</option>
                        <option value="none">なし</option>
                    </select>
                </div>
                <!-- 期間フィルター -->
                <div class="flex items-center gap-2">
                    <label for="period-filter" class="text-sm font-medium">期間:</label>
                    <select id="period-filter" class="header-select text-sm">
                        <option value="yesterday">昨日</option>
                        <option value="weekly" selected>直近7日</option>
                        <option value="monthly">直近30日</option>
                        <option value="all">全期間</option>
                    </select>
                </div>
            </div>
        </div>
    </nav>

    <!-- ダッシュボード メインコンテンツ -->
    <main class="p-6">
        <!-- grid grid-cols-1 (モバイル) -> md:grid-cols-4 (デスクトップ) -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">

            <!-- セクション 1: 顧客満足度 (CS) -->
            <h2 class="text-2xl font-semibold text-gray-800 mb-0 md:col-span-4">顧客満足度 (CS)</h2>

            <!-- カード 1: 劇場総合満足度 (Q15) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-1">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Star -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">劇場総合満足度</h3>
                    <span class="text-xs text-gray-400">Q15</span>
                </div>
                <!-- メインスコア -->
                <div class="text-center mb-2">
                    <span id="main-score-value" class="text-5xl font-bold text-gray-800">8.2</span>
                    <span class="text-2xl text-gray-500">/ 10</span>
                </div>
                <!-- 変動インジケーター -->
                <div class="flex justify-center gap-4 mb-3 text-sm">
                    <div>
                        <span class="text-gray-500">前日比:</span>
                        <span id="score-vs-yesterday" class="font-bold"></span>
                    </div>
                    <div>
                        <span class="text-gray-500">前週比:</span>
                        <span id="score-vs-lastweek" class="font-bold"></span>
                    </div>
                </div>
                <!-- 比較スコア -->
                <div class="text-sm text-center space-y-1">
                    <div id="benchmark-score-container">
                        <span class="font-semibold">業界平均:</span>
                        <span id="benchmark-score-value" class="font-bold text-blue-600">7.8</span>
                    </div>
                    <div>
                        <span class="font-semibold">自社平均:</span>
                        <span id="company-score-value" class="font-bold text-green-600">7.9</span>
                    </div>
                </div>
            </div>

            <!-- カード 2: 劇場NPS (Q14) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-1">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Smile -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smile"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">劇場NPS</h3>
                    <span class="text-xs text-gray-400">Q14</span>
                </div>
                <!-- メインスコア -->
                <div class="text-center mb-2">
                    <span id="nps-score-value" class="text-5xl font-bold text-gray-800">+12.5</span>
                </div>
                <!-- 変動インジケーター -->
                <div class="flex justify-center gap-4 mb-2 text-sm">
                    <div>
                        <span class="text-gray-500">前日比:</span>
                        <span id="nps-vs-yesterday" class="font-bold"></span>
                    </div>
                    <div>
                        <span class="text-gray-500">前週比:</span>
                        <span id="nps-vs-lastweek" class="font-bold"></span>
                    </div>
                </div>
                <!-- 詳細 -->
                <div class="h-32 -mt-4">
                    <canvas id="npsTheaterChart"></canvas>
                </div>
            </div>

            <!-- カード 3: 自社劇場ランキング (Q15) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-2">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Award -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#4F46E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-award"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">自社劇場ランキング (総合満足度)</h3>
                    <span class="text-xs text-gray-400">Q15</span>
                </div>
                <div class="h-48">
                    <canvas id="rankingChart"></canvas>
                </div>
            </div>

            <!-- カード 11: 劇場への具体的なご意見 (Q25) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-2 h-96">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Message Square -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#6B7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">劇場への具体的なご意見</h3>
                    <span class="text-xs text-gray-400">Q25</span>
                </div>
                <!-- コメントフィルター -->
                <div class="flex flex-wrap gap-4 mb-4">
                    <!-- ポジ/ネガ タブ -->
                    <div class="flex rounded-md shadow-sm">
                        <button id="comment-filter-all" class="comment-filter-btn active">全て</button>
                        <button id="comment-filter-posi" class="comment-filter-btn">ポジティブ</button>
                        <button id="comment-filter-nega" class="comment-filter-btn">ネガティブ</button>
                    </div>
                    <!-- キーワードフィルター -->
                    <div>
                        <select id="comment-keyword-filter" class="header-select text-sm" style="background-color: #f3f4f6; color: #1f2937; border-color: #d1d5db; padding-top: 0.375rem; padding-bottom: 0.375rem;">
                            <option value="all">全キーワード</option>
                            <option value="staff">接客・スタッフ</option>
                            <option value="seat">座席</option>
                            <option value="sound">音響</option>
                            <option value="clean">清潔さ</option>
                            <option value="food">売店・飲食</option>
                            <option value="toilet">トイレ</option>
                        </select>
                    </div>
                </div>
                <div id="comment-list" class="h-64 overflow-y-auto feedback-scroll pr-2 space-y-4">
                    <!-- コメントはJSによって動的に挿入されます -->
                </div>
            </div>

            <!-- カード 8: 劇場の高評価ポイント (Q16) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-2 h-96">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Thumbs Up -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0D9488" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-up"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a2 2 0 0 1 1.79 1.11L15 5.88V10Z"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">劇場の高評価ポイント (比較)</h3>
                    <span class="text-xs text-gray-400">Q16</span>
                </div>
                <div class="h-80">
                    <canvas id="evaluationChart"></canvas>
                </div>
            </div>

            <!-- セクション 2: 劇場運営KPI -->
            <h2 class="text-2xl font-semibold text-gray-800 mb-0 md:col-span-4 mt-6">劇場運営KPI</h2>

            <!-- カード 4: コンセッション（飲食）購入率 (Q17) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-1">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Popcorn -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#F97316" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-popcorn"><path d="M18 8a2 2 0 0 0 0-4 2 2 0 0 0-4 0 2 2 0 0 0-4 0 2 2 0 0 0-4 0 2 2 0 0 0 0 4"/><path d="M18 8V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3"/><path d="M6 8V5a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v3"/><path d="M18 8h.01"/><path d="M6 8h.01"/><path d="M14 8h.01"/><path d="M10 8h.01"/><path d="M20 12v10H4V12a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4Z"/><path d="m14 17 2 3"/><path d="m10 17-2 3"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">飲食購入率</h3>
                    <span class="text-xs text-gray-400">Q17</span>
                </div>
                <!-- メインスコア (変動) -->
                <div class="text-center mb-4">
                    <span id="concession-rate" class="text-5xl font-bold text-gray-800">55.0<span class="text-3xl">%</span></span>
                    <div class="flex justify-center gap-4 mt-2 text-sm">
                        <div>
                            <span class="text-gray-500">前日比:</span>
                            <span id="concession-vs-yesterday" class="font-bold"></span>
                        </div>
                        <div>
                            <span class="text-gray-500">前週比:</span>
                            <span id="concession-vs-lastweek" class="font-bold"></span>
                        </div>
                    </div>
                </div>
                <div class="h-48 flex items-center justify-center">
                    <canvas id="concessionChart"></canvas>
                </div>
            </div>

            <!-- カード 7: チケット購入方法 (Q19) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-1">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Ticket -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#DB2777" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ticket"><path d="M4 14a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-4a2 2 0 0 0-4 0Z"/><path d="M9 16h6"/><path d="M12 12v8"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">チケット購入方法</h3>
                    <span class="text-xs text-gray-400">Q19</span>
                </div>
                <div class="h-72 flex items-center justify-center">
                    <canvas id="ticketChart"></canvas>
                </div>
            </div>

            <!-- カード 10: 映画館選択の重視要素 (Q21) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-2">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Check Circle -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#65A30D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-check"><path d="M18 6 7 17l-5-5"/><path d="m22 10-7.5 7.5L13 16"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">映画館選択の重視要素 (Top3)</h3>
                    <span class="text-xs text-gray-400">Q21</span>
                </div>
                <div class="h-72">
                    <canvas id="emphasisChart"></canvas>
                </div>
            </div>

            <!-- セクション 3: 作品ヒットポテンシャル分析 -->
            <h2 id="work-potential-title" class="text-2xl font-semibold text-gray-800 mb-0 md:col-span-4 mt-6">
                作品ヒットポテンシャル分析
            </h2>

            <!-- [新規] 横並び比較テーブル (作品フィルター「全作品」選択時に表示) -->
            <div id="potential-ranking-table" class="bg-white p-5 rounded-lg shadow md:col-span-4 hidden">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Align End Horizontal -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#2563EB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-align-end-horizontal"><line x1="22" x2="2" y1="20" y2="20"/><path d="M4 16v-6a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v6"/><path d="M10 16V4a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v12"/><path d="M16 16v-9a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v9"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">公開中作品 ポテンシャル比較</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">作品名</th>
                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">作品NPS (Q5)</th>
                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">リピート熱量 (Q4)</th>
                                <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">コア層NPS (Q18xQ5)</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ポテンシャル診断</th>
                            </tr>
                        </thead>
                        <tbody id="potential-ranking-body" class="bg-white divide-y divide-gray-200">
                            <!-- JSで動的に挿入 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 個別分析カードコンテナ (作品選択時に表示) -->
            <div id="work-potential-cards-container" class="md:col-span-4 grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- プレースホルダー -->
                <div id="work-potential-placeholder" class="md:col-span-4 bg-white p-5 rounded-lg shadow text-center text-gray-500">
                    <p>ヘッダーの「作品フィルター」で作品を選択すると、ヒットポテンシャル分析が表示されます。</p>
                </div>

                <!-- カード A: 作品NPS (Q5) -->
                <div id="card-work-nps" class="bg-white p-5 rounded-lg shadow md:col-span-1 hidden">
                    <div class="flex items-center space-x-2 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#E11D48" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart-pulse"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/><path d="M3.22 12H9.5l.7-1.4L13.5 14H20.8"/></svg>
                        <h3 class="font-semibold text-lg text-gray-700">作品NPS (おすすめ度)</h3>
                        <span class="text-xs text-gray-400">Q5</span>
                    </div>
                    <div class="text-center mb-2">
                        <span id="work-nps-score" class="text-5xl font-bold text-gray-800"></span>
                    </div>
                    <div class="h-32">
                        <canvas id="workNpsChart"></canvas>
                    </div>
                </div>

                <!-- カード B: リピート意向 (Q4) -->
                <div id="card-work-repeat" class="bg-white p-5 rounded-lg shadow md:col-span-1 hidden">
                    <div class="flex items-center space-x-2 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#D97706" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-cw"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>
                        <h3 class="font-semibold text-lg text-gray-700">リピート熱量</h3>
                        <span class="text-xs text-gray-400">Q4</span>
                    </div>
                    <div class="text-center mb-2">
                        <span id="work-repeat-rate" class="text-5xl font-bold text-gray-800"></span>
                        <span class="text-xl text-gray-500">%</span>
                        <p class="text-sm text-gray-500">（「ぜひ観たい」「別フォーマットで」の合計）</p>
                    </div>
                    <div class="h-32">
                        <canvas id="workRepeatChart"></canvas>
                    </div>
                </div>

                <!-- カード C: コア層の評価 (Q18 x Q5) -->
                <div id="card-work-core" class="bg-white p-5 rounded-lg shadow md:col-span-1 hidden">
                    <div class="flex items-center space-x-2 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></svg>
                        <h3 class="font-semibold text-lg text-gray-700">コア層 vs ライト層 NPS</h3>
                        <span class="text-xs text-gray-400">Q18, Q5</span>
                    </div>
                    <div class="h-48">
                        <canvas id="workCoreChart"></canvas>
                    </div>
                </div>

                <!-- カード D: 総合ポテンシャル診断 -->
                <div id="card-work-potential" class="bg-white p-5 rounded-lg shadow md:col-span-1 hidden">
                    <div class="flex items-center space-x-2 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#4F46E5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                        <h3 class="font-semibold text-lg text-gray-700">総合ポテンシャル</h3>
                    </div>
                    <div class="text-center my-6">
                        <span id="work-potential-rank" class="text-8xl font-bold text-indigo-600"></span>
                    </div>
                    <ul class="space-y-2 text-sm">
                        <li class="flex justify-between">
                            <span class="text-gray-600">口コミ拡散力:</span>
                            <span id="work-summary-word" class="font-bold"></span>
                        </li>
                        <li class="flex justify-between">
                            <span class="text-gray-600">リピート期待:</span>
                            <span id="work-summary-repeat" class="font-bold"></span>
                        </li>
                        <li class="flex justify-between">
                            <span class="text-gray-600">コア層支持:</span>
                            <span id="work-summary-core" class="font-bold"></span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- セクション 4: 顧客プロファイル (元セクション3) -->
            <h2 class="text-2xl font-semibold text-gray-800 mb-0 md:col-span-4 mt-6">顧客プロファイル</h2>

            <!-- カード 9: 来場者プロフィール (性年代) (Q11, Q12) [レイアウト変更] -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-4">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Users -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">来場者プロフィール (性年代)</h3>
                    <span class="text-xs text-gray-400">Q11, Q12</span>
                </div>
                <div class="h-80">
                    <canvas id="profileChart"></canvas>
                </div>
            </div>

            <!-- カード 5: リピーター分析 (Q3) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-1">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Refresh -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0EA5E9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M3 12a9 9 0 0 1 9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">作品リピート分析</h3>
                    <span class="text-xs text-gray-400">Q3</span>
                </div>
                <div class="h-72 flex items-center justify-center">
                    <canvas id="repeaterChart"></canvas>
                </div>
            </div>

            <!-- カード 6: 来場頻度 (Q18) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-1">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Calendar -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#8B5CF6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">来場頻度</h3>
                    <span class="text-xs text-gray-400">Q18</span>
                </div>
                <div class="h-72">
                    <canvas id="frequencyChart"></canvas>
                </div>
            </div>

            <!-- 新規カード: 休眠・新規来場者 (Q18) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-1">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: Zap -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#16A34A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zap"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2z"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">休眠・新規来場者</h3>
                    <span class="text-xs text-gray-400">Q18</span>
                </div>
                <div class="h-72 flex items-center justify-center">
                    <canvas id="dormantChart"></canvas>
                </div>
            </div>

            <!-- 新規カード: 鑑賞人数 (おひとりさま率) (Q27) -->
            <div class="bg-white p-5 rounded-lg shadow md:col-span-1">
                <div class="flex items-center space-x-2 mb-4">
                    <!-- Icon: User -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#CA8A04" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <h3 class="font-semibold text-lg text-gray-700">おひとりさま率</h3>
                    <span class="text-xs text-gray-400">Q27</span>
                </div>
                <div class="h-72 flex items-center justify-center">
                    <canvas id="soloChart"></canvas>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- モックデータ ---
        const mockData = {
            cineplexA: { // 旧 shinjuku
                name: 'Aシネマ',
                // 期間別データ
                yesterday: {
                    score: 8.1, score_vs_yesterday: null, score_vs_lastweek: +0.1,
                    nps: { score: +11.0, promoter: 39, passive: 43, detractor: 18, vs_yesterday: null, vs_lastweek: +2.0 },
                    concession: { buy: 53.0, notBuy: 47.0, vs_yesterday: null, vs_lastweek: -1.5 },
                },
                weekly: {
                    score: 8.2, score_vs_yesterday: +0.1, score_vs_lastweek: +0.2,
                    nps: { score: +12.5, promoter: 40, passive: 45, detractor: 15, vs_yesterday: +1.5, vs_lastweek: +3.0 },
                    concession: { buy: 55.0, notBuy: 45.0, vs_yesterday: +2.0, vs_lastweek: +1.5 },
                },
                monthly: {
                    score: 8.0, score_vs_yesterday: -0.1, score_vs_lastweek: -0.1,
                    nps: { score: +10.0, promoter: 38, passive: 44, detractor: 18, vs_yesterday: -1.0, vs_lastweek: +1.0 },
                    concession: { buy: 54.0, notBuy: 46.0, vs_yesterday: -1.0, vs_lastweek: +0.5 },
                },
                all: {
                    score: 8.1, score_vs_yesterday: 0, score_vs_lastweek: +0.1,
                    nps: { score: +11.5, promoter: 39, passive: 45, detractor: 16, vs_yesterday: +0.5, vs_lastweek: +1.5 },
                    concession: { buy: 54.5, notBuy: 45.5, vs_yesterday: -0.5, vs_lastweek: +1.0 },
                },
                // 期間共通データ (デモのため簡略化)
                repeater: { first: 70, second: 20, thirdOver: 10 }, // Q3
                frequency: [10, 25, 40, 15, 10], // Q18
                dormant: { new: 5, comeback_3y: 8, comeback_1y: 12, active: 75 }, // Q18 (新規)
                solo: { solo: 45, multiple: 55 }, // Q27 (新規)
                ticket: [60, 20, 15, 5], // Q19
                evaluation: [65, 75, 80, 70, 40, 60, 50, 78], // Q16 (8項目)
                emphasis: [75, 60, 55, 40, 30, 25, 10], // Q21
                profile: { // Q11, Q12 (変更)
                    labels: ["10代男性", "10代女性", "20代男性", "20代女性", "30代男性", "30代女性", "40代男性", "40代女性", "50代男性", "50代女性", "60代+"],
                    data: [100, 120, 300, 350, 250, 280, 200, 220, 150, 180, 120], // male/femaleを交互に
                    colors: ['#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#6B7280']
                },
                comments: [ // Q25
                    { text: "もう少し座席の前後の間隔が広いと嬉しいです。", user: "30代女性", sentiment: "negative", keywords: ["seat"] },
                    { text: "ポップコーンやドリンク以外のフードメニューがもっと充実すると嬉しい。", user: "20代女性", sentiment: "negative", keywords: ["food"] },
                    { text: "IMAXの上映がとても良かった。音響が素晴らしく、迫力が違った。", user: "40代男性", sentiment: "positive", keywords: ["sound"] },
                    { text: "スタッフさんの対応がいつも丁寧で気持ちが良いです。", user: "50代女性", sentiment: "positive", keywords: ["staff"] },
                    { text: "チケットの自動発券機がもう少し多いと助かります。", user: "20代男性", sentiment: "negative", keywords: [] },
                    { text: "トイレがいつも清潔で素晴らしい。", user: "40代女性", sentiment: "positive", keywords: ["clean", "toilet"] },
                ],
                // 作品個別分析データ
                works: {
                    "sample-a": {
                        nps: { score: +45.0, promoter: 60, passive: 30, detractor: 10 }, // Q5
                        repeat_intent: { must: 35, format: 15, maybe: 30, no: 20 }, // Q4
                        core_nps: { core: +60.0, light: +30.0 }, // Q18 x Q5
                        potential_rank: "A+",
                        summary: { word_of_mouth: "高", repeat: "高", core_support: "高" }
                    },
                    "sample-b": {
                        nps: { score: +10.0, promoter: 40, passive: 30, detractor: 30 }, // Q5
                        repeat_intent: { must: 10, format: 5, maybe: 40, no: 45 }, // Q4
                        core_nps: { core: +5.0, light: +15.0 }, // Q18 x Q5
                        potential_rank: "B-",
                        summary: { word_of_mouth: "中", repeat: "低", core_support: "低" }
                    }
                },
                // 作品横並び比較データ
                work_analytics: [
                    {
                        id: 'sample-a', name: 'サンプル作品A', nps: +45.0,
                        repeat_heat: 50.0, // (must + format)
                        core_nps: +60.0, potential_rank: "A+",
                        comment: '口コミ・リピート・コア層すべて高水準。'
                    },
                    {
                        id: 'sample-b', name: 'サンプル作品B', nps: +10.0,
                        repeat_heat: 15.0, // (must + format)
                        core_nps: +5.0, potential_rank: "B-",
                        comment: 'ライト層中心。口コミ・リピートに課題。'
                    }
                ]
            },
            cineplexB: {
                name: 'Bシネマ',
                weekly: { score: 8.5, score_vs_yesterday: +0.2, score_vs_lastweek: +0.3, nps: { score: +20.0, promoter: 48, passive: 40, detractor: 12, vs_yesterday: +1.0, vs_lastweek: +2.5 }, concession: { buy: 65, notBuy: 35, vs_yesterday: +1.0, vs_lastweek: +2.0 } },
                yesterday: { score: 8.4, score_vs_yesterday: null, score_vs_lastweek: +0.2, nps: { score: +19.0, promoter: 47, passive: 40, detractor: 13, vs_yesterday: null, vs_lastweek: +2.0 }, concession: { buy: 64, notBuy: 36, vs_yesterday: null, vs_lastweek: +1.0 } },
                monthly: { score: 8.4, score_vs_yesterday: 0, score_vs_lastweek: +0.1, nps: { score: +18.0, promoter: 46, passive: 41, detractor: 13, vs_yesterday: 0, vs_lastweek: +1.0 }, concession: { buy: 63, notBuy: 37, vs_yesterday: -1.0, vs_lastweek: 0 } },
                all: { score: 8.4, score_vs_yesterday: 0, score_vs_lastweek: +0.1, nps: { score: +18.0, promoter: 46, passive: 41, detractor: 13, vs_yesterday: 0, vs_lastweek: +1.0 }, concession: { buy: 63, notBuy: 37, vs_yesterday: -1.0, vs_lastweek: 0 } },
                repeater: { first: 65, second: 22, thirdOver: 13 }, frequency: [15, 30, 35, 12, 8], dormant: { new: 3, comeback_3y: 5, comeback_1y: 10, active: 82 }, solo: { solo: 35, multiple: 65 }, ticket: [70, 15, 10, 5], evaluation: [70, 80, 85, 75, 45, 65, 55, 80], emphasis: [80, 58, 60, 38, 35, 28, 12],
                profile: {
                    labels: ["10代男性", "10代女性", "20代男性", "20代女性", "30代男性", "30代女性", "40代男性", "40代女性", "50代男性", "50代女性", "60代+"],
                    data: [80, 90, 250, 280, 300, 320, 280, 300, 200, 220, 180],
                    colors: ['#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#6B7280']
                },
                comments: [],
                works: {
                    "sample-a": {
                        nps: { score: +50.0, promoter: 65, passive: 25, detractor: 10 },
                        repeat_intent: { must: 40, format: 20, maybe: 25, no: 15 },
                        core_nps: { core: +70.0, light: +35.0 },
                        potential_rank: "A+",
                        summary: { word_of_mouth: "高", repeat: "高", core_support: "高" }
                    },
                    "sample-b": {
                        nps: { score: +12.0, promoter: 42, passive: 28, detractor: 30 },
                        repeat_intent: { must: 12, format: 6, maybe: 38, no: 44 },
                        core_nps: { core: +8.0, light: +15.0 },
                        potential_rank: "B",
                        summary: { word_of_mouth: "中", repeat: "低", core_support: "低" }
                    }
                },
                work_analytics: [
                    {
                        id: 'sample-a', name: 'サンプル作品A', nps: +50.0,
                        repeat_heat: 60.0, core_nps: +70.0, potential_rank: "A+",
                        comment: '熱狂的なファンが牽引。'
                    },
                    {
                        id: 'sample-b', name: 'サンプル作品B', nps: +12.0,
                        repeat_heat: 18.0, core_nps: +8.0, potential_rank: "B",
                        comment: '標準的な評価。'
                    }
                ]
            },
            cineplexC: {
                name: 'Cシネコン',
                weekly: { score: 8.1, score_vs_yesterday: -0.1, score_vs_lastweek: -0.2, nps: { score: +10.0, promoter: 38, passive: 46, detractor: 16, vs_yesterday: -2.0, vs_lastweek: -1.0 }, concession: { buy: 60, notBuy: 40, vs_yesterday: 0, vs_lastweek: +1.0 } },
                all: { score: 8.1, score_vs_yesterday: -0.1, score_vs_lastweek: -0.2, nps: { score: +10.0, promoter: 38, passive: 46, detractor: 16, vs_yesterday: -2.0, vs_lastweek: -1.0 }, concession: { buy: 60, notBuy: 40, vs_yesterday: 0, vs_lastweek: +1.0 } },
                repeater: { first: 72, second: 18, thirdOver: 10 }, frequency: [8, 22, 42, 18, 10], dormant: { new: 6, comeback_3y: 10, comeback_1y: 14, active: 70 }, solo: { solo: 50, multiple: 50 }, ticket: [65, 22, 10, 3], evaluation: [60, 70, 82, 68, 50, 62, 48, 75], emphasis: [78, 62, 58, 42, 28, 22, 8],
                profile: {
                    labels: ["10代男性", "10代女性", "20代男性", "20代女性", "30代男性", "30代女性", "40代男性", "40代女性", "50代男性", "50代女性", "60代+"],
                    data: [90, 100, 280, 310, 290, 300, 240, 250, 170, 190, 140],
                    colors: ['#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#6B7280']
                },
                comments: [],
                works: { "sample-a": { nps: { score: +40.0, promoter: 55, passive: 35, detractor: 10 }, repeat_intent: { must: 30, format: 10, maybe: 40, no: 20 }, core_nps: { core: +55.0, light: +25.0 }, potential_rank: "A", summary: { word_of_mouth: "高", repeat: "中", core_support: "高" }}, "sample-b": { nps: { score: +5.0, promoter: 35, passive: 35, detractor: 30 }, repeat_intent: { must: 8, format: 2, maybe: 40, no: 50 }, core_nps: { core: 0, light: +10.0 }, potential_rank: "C", summary: { word_of_mouth: "低", repeat: "低", core_support: "低" }}},
                work_analytics: [
                    {
                        id: 'sample-a', name: 'サンプル作品A', nps: +40.0,
                        repeat_heat: 40.0, core_nps: +55.0, potential_rank: "A",
                        comment: '高評価だが、リピート熱量は中程度。'
                    },
                    {
                        id: 'sample-b', name: 'サンプル作品B', nps: +5.0,
                        repeat_heat: 10.0, core_nps: 0, potential_rank: "C",
                        comment: '評価が伸び悩んでいる。'
                    }
                ]
            },
            cineplexD: {
                name: 'Dシネコン',
                weekly: { score: 7.9, score_vs_yesterday: 0, score_vs_lastweek: -0.3, nps: { score: +5.0, promoter: 35, passive: 40, detractor: 25, vs_yesterday: +1.0, vs_lastweek: -2.0 }, concession: { buy: 50, notBuy: 50, vs_yesterday: -1.0, vs_lastweek: -3.0 } },
                all: { score: 7.9, score_vs_yesterday: 0, score_vs_lastweek: -0.3, nps: { score: +5.0, promoter: 35, passive: 40, detractor: 25, vs_yesterday: +1.0, vs_lastweek: -2.0 }, concession: { buy: 50, notBuy: 50, vs_yesterday: -1.0, vs_lastweek: -3.0 } },
                repeater: { first: 80, second: 15, thirdOver: 5 }, frequency: [12, 30, 38, 10, 10], dormant: { new: 8, comeback_3y: 12, comeback_1y: 15, active: 65 }, solo: { solo: 55, multiple: 45 }, ticket: [55, 25, 15, 5], evaluation: [55, 65, 75, 60, 35, 50, 40, 70], emphasis: [70, 65, 50, 45, 30, 20, 15],
                profile: {
                    labels: ["10代男性", "10代女性", "20代男性", "20代女性", "30代男性", "30代女性", "40代男性", "40代女性", "50代男性", "50代女性", "60代+"],
                    data: [150, 180, 400, 450, 200, 220, 150, 180, 100, 120, 90],
                    colors: ['#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#3B82F6', '#EC4899', '#6B7280']
                },
                comments: [],
                works: { "sample-a": { nps: { score: +35.0, promoter: 50, passive: 40, detractor: 10 }, repeat_intent: { must: 25, format: 10, maybe: 40, no: 25 }, core_nps: { core: +40.0, light: +30.0 }, potential_rank: "A-", summary: { word_of_mouth: "高", repeat: "中", core_support: "中" }}, "sample-b": { nps: { score: +15.0, promoter: 45, passive: 25, detractor: 30 }, repeat_intent: { must: 15, format: 5, maybe: 40, no: 40 }, core_nps: { core: +10.0, light: +20.0 }, potential_rank: "B", summary: { word_of_mouth: "中", repeat: "低", core_support: "低" }}},
                work_analytics: [
                    {
                        id: 'sample-a', name: 'サンプル作品A', nps: +35.0,
                        repeat_heat: 35.0, core_nps: +40.0, potential_rank: "A-",
                        comment: 'コア層の支持は中程度。'
                    },
                    {
                        id: 'sample-b', name: 'サンプル作品B', nps: +15.0,
                        repeat_heat: 20.0, core_nps: +10.0, potential_rank: "B",
                        comment: 'ライト層中心でリピートに繋がらず。'
                    }
                ]
            },
            benchmark: {
                industry: {
                    score: 7.8,
                    evaluation: [60, 68, 70, 65, 38, 55, 42, 72], // Q16 (8項目)
                },
                company: {
                    score: 7.9,
                    evaluation: [62, 70, 72, 67, 40, 58, 45, 74], // Q16 (8項目)
                }
            }
        };

        // チャートのインスタンスをグローバルに保持
        let rankingChart, npsTheaterChart, concessionChart, repeaterChart, frequencyChart, ticketChart, evaluationChart, profileChart, emphasisChart, dormantChart, soloChart;
        let workNpsChart, workRepeatChart, workCoreChart;

        let selectedCineplex = 'cineplexA';
        let selectedBenchmark = 'industry';
        let selectedPeriod = 'weekly';
        let selectedWork = 'all';
        let currentCommentSentiment = 'all';
        let currentCommentKeyword = 'all';

        // チャートの初期化
        function initCharts() {
            // カード 3: 自社劇場ランキング (Q15)
            const rankingCtx = document.getElementById('rankingChart').getContext('2d');
            rankingChart = new Chart(rankingCtx, {
                type: 'bar',
                data: {
                    labels: ['Bシネマ', 'Aシネマ', 'Cシネコン', 'Dシネコン'],
                    datasets: [{
                        label: '総合満足度',
                        data: [
                            mockData.cineplexB.weekly.score,
                            mockData.cineplexA.weekly.score,
                            mockData.cineplexC.weekly.score,
                            mockData.cineplexD.weekly.score
                        ],
                        backgroundColor: [
                            '#D1D5DB', '#4F46E5', '#D1D5DB', '#D1D5DB',
                        ],
                        borderRadius: 4,
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: (context) => `${context.dataset.label}: ${context.raw.toFixed(1)}` } } },
                    scales: { x: { beginAtZero: false, min: 7.0, max: 9.0, grid: { display: false } }, y: { grid: { display: false } } }
                }
            });

            // カード 2: 劇場NPS (Q14)
            const npsTheaterCtx = document.getElementById('npsTheaterChart').getContext('2d');
            npsTheaterChart = new Chart(npsTheaterCtx, {
                type: 'doughnut',
                data: {
                    labels: ['推奨者', '中立者', '批判者'],
                    datasets: [{
                        data: [
                            mockData.cineplexA.weekly.nps.promoter,
                            mockData.cineplexA.weekly.nps.passive,
                            mockData.cineplexA.weekly.nps.detractor
                        ],
                        backgroundColor: ['#10B981', '#F59E0B', '#EF4444'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '60%',
                    plugins: { legend: { position: 'bottom', labels: { padding: 15, boxWidth: 12 } }, tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw}%` } } }
                }
            });

            // カード 4: コンセッション（飲食）購入率 (Q17)
            const concessionCtx = document.getElementById('concessionChart').getContext('2d');
            concessionChart = new Chart(concessionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['購入', '非購入'],
                    datasets: [{
                        data: [mockData.cineplexA.weekly.concession.buy, mockData.cineplexA.weekly.concession.notBuy],
                        backgroundColor: ['#F97316', '#D1D5DB'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { padding: 15, boxWidth: 12 } }, tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw.toFixed(1)}%` } } }
                }
            });

            // カード 5: リピーター分析 (Q3)
            const repeaterCtx = document.getElementById('repeaterChart').getContext('2d');
            repeaterChart = new Chart(repeaterCtx, {
                type: 'doughnut',
                data: {
                    labels: ['初めて', '2回目', '3回目以上'],
                    datasets: [{
                        data: [
                            mockData.cineplexA.repeater.first,
                            mockData.cineplexA.repeater.second,
                            mockData.cineplexA.repeater.thirdOver
                        ],
                        backgroundColor: ['#0EA5E9', '#0891B2', '#0E7490'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { padding: 15, boxWidth: 12 } }, tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw}%` } } }
                }
            });

            // カード 6: 来場頻度 (Q18)
            const frequencyCtx = document.getElementById('frequencyChart').getContext('2d');
            frequencyChart = new Chart(frequencyCtx, {
                type: 'bar',
                data: {
                    labels: ['月1回以上', '2-3ヶ月に1回', '半年に1回', '1年に1回', '1年超ぶり'],
                    datasets: [{
                        label: '来場頻度',
                        data: mockData.cineplexA.frequency,
                        backgroundColor: '#8B5CF6',
                        borderRadius: 4,
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { display: false }, ticks: { callback: (value) => `${value}%` } }, y: { grid: { display: false } } }
                }
            });

            // カード 7: チケット購入方法 (Q19)
            const ticketCtx = document.getElementById('ticketChart').getContext('2d');
            ticketChart = new Chart(ticketCtx, {
                type: 'doughnut',
                data: {
                    labels: ['劇場サイト', '当日窓口', '前売り券', 'その他'],
                    datasets: [{
                        data: mockData.cineplexA.ticket,
                        backgroundColor: ['#DB2777', '#BE185D', '#9D174D', '#831843'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { padding: 15, boxWidth: 12 } }, tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw}%` } } }
                }
            });

            // カード 8: 劇場の高評価ポイント (Q16)
            const evaluationCtx = document.getElementById('evaluationChart').getContext('2d');
            evaluationChart = new Chart(evaluationCtx, {
                type: 'bar',
                data: {
                    labels: ['接客', '座席', '音響', '清潔さ', '売店', 'チケット', 'ロビー', '立地'],
                    datasets: [
                        {
                            label: 'Aシネマ',
                            data: mockData.cineplexA.evaluation,
                            backgroundColor: '#0D9488',
                            borderRadius: 4,
                        },
                        {
                            label: '業界平均',
                            data: mockData.benchmark.industry.evaluation,
                            backgroundColor: '#99F6E4',
                            borderRadius: 4,
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { x: { grid: { display: false }, }, y: { grid: { display: false }, ticks: { callback: (value) => `${value}%` } } }
                }
            });

            // カード 9: 来場者プロフィール (性年代) (Q11, Q12) [変更]
            const profileCtx = document.getElementById('profileChart').getContext('2d');
            profileChart = new Chart(profileCtx, {
                type: 'bar',
                data: {
                    labels: mockData.cineplexA.profile.labels,
                    datasets: [
                        {
                            label: '来場者数',
                            data: mockData.cineplexA.profile.data,
                            backgroundColor: mockData.cineplexA.profile.colors,
                            borderRadius: 4,
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { display: false }, }, y: { grid: { display: true }, } }
                }
            });

            // カード 10: 映画館選択の重視要素 (Q21)
            const emphasisCtx = document.getElementById('emphasisChart').getContext('2d');
            emphasisChart = new Chart(emphasisCtx, {
                type: 'bar',
                data: {
                    labels: ['立地・アクセス', 'ラインナップ', '設備', '料金', '会員サービス', '座席', 'その他'],
                    datasets: [{
                        label: '重視する要素 (Top3回答率)',
                        data: mockData.cineplexA.emphasis,
                        backgroundColor: '#65A30D',
                        borderRadius: 4,
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { display: false }, ticks: { callback: (value) => `${value}%` } }, y: { grid: { display: false } } }
                }
            });

            // 新規カード: 休眠・新規来場者 (Q18)
            const dormantCtx = document.getElementById('dormantChart').getContext('2d');
            dormantChart = new Chart(dormantCtx, {
                type: 'doughnut',
                data: {
                    labels: ['人生初', '3年超ぶり', '1年超ぶり', 'アクティブ'],
                    datasets: [{
                        data: [
                            mockData.cineplexA.dormant.new,
                            mockData.cineplexA.dormant.comeback_3y,
                            mockData.cineplexA.dormant.comeback_1y,
                            mockData.cineplexA.dormant.active,
                        ],
                        backgroundColor: ['#16A34A', '#65A30D', '#A3E635', '#D1D5DB'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { padding: 15, boxWidth: 12 } }, tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw}%` } } }
                }
            });

            // 新規カード: おひとりさま率 (Q27)
            const soloCtx = document.getElementById('soloChart').getContext('2d');
            soloChart = new Chart(soloCtx, {
                type: 'doughnut',
                data: {
                    labels: ['1人', '2人以上'],
                    datasets: [{
                        data: [
                            mockData.cineplexA.solo.solo,
                            mockData.cineplexA.solo.multiple,
                        ],
                        backgroundColor: ['#CA8A04', '#FDE047'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { padding: 15, boxWidth: 12 } }, tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw}%` } } }
                }
            });

            // --- ↓↓↓ 新規作品ポテンシャルチャートの初期化 ↓↓↓ ---

            // カード A: 作品NPS (Q5)
            const workNpsCtx = document.getElementById('workNpsChart').getContext('2d');
            workNpsChart = new Chart(workNpsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['推奨者', '中立者', '批判者'],
                    datasets: [{
                        data: [0, 0, 0], // 初期値
                        backgroundColor: ['#10B981', '#F59E0B', '#EF4444'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '60%',
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw}%` } } }
                }
            });

            // カード B: リピート意向 (Q4)
            const workRepeatCtx = document.getElementById('workRepeatChart').getContext('2d');
            workRepeatChart = new Chart(workRepeatCtx, {
                type: 'doughnut',
                data: {
                    labels: ['熱望(ぜひ/別)', '検討', '観ない'],
                    datasets: [{
                        data: [0, 0, 0], // 初期値
                        backgroundColor: ['#D97706', '#F59E0B', '#D1D5DB'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '60%',
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw}%` } } }
                }
            });

            // カード C: コア層 vs ライト層 (Q18 x Q5)
            const workCoreCtx = document.getElementById('workCoreChart').getContext('2d');
            workCoreChart = new Chart(workCoreCtx, {
                type: 'bar',
                data: {
                    labels: ['コア層NPS', 'ライト層NPS'],
                    datasets: [{
                        label: 'NPSスコア',
                        data: [0, 0], // 初期値
                        backgroundColor: ['#059669', '#6EE7B7'],
                        borderRadius: 4,
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { display: false }, min: -50, max: 100 }, y: { grid: { display: false } } }
                }
            });

        } // --- initCharts() 終了 ---

        // --- 変動インジケーターの更新ヘルパー ---
        function updateTrendIndicator(elementId, value, unit = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            if (value === null || value === undefined) {
                element.textContent = '-';
                element.className = 'font-bold text-gray-500';
                return;
            }
            const plus = value > 0 ? '+' : '';
            element.textContent = `${plus}${value.toFixed(1)}${unit}`;
            if (value > 0) { element.className = 'font-bold text-green-500'; }
            else if (value < 0) { element.className = 'font-bold text-red-500'; }
            else { element.className = 'font-bold text-gray-500'; }
        }

        // --- コメントリストの更新 ---
        function updateCommentList() {
            const cineplexData = mockData[selectedCineplex];
            const commentListEl = document.getElementById('comment-list');
            commentListEl.innerHTML = '';

            const filteredComments = cineplexData.comments.filter(comment => {
                const sentimentMatch = (currentCommentSentiment === 'all') || (comment.sentiment === currentCommentSentiment);
                const keywordMatch = (currentCommentKeyword === 'all') || (comment.keywords.includes(currentCommentKeyword));
                return sentimentMatch && keywordMatch;
            });

            if (filteredComments.length === 0) {
                commentListEl.innerHTML = `<p class="text-gray-500 text-sm">該当するコメントはありません。</p>`;
                return;
            }

            filteredComments.forEach(comment => {
                let sentimentColor = 'text-gray-500';
                if (comment.sentiment === 'positive') sentimentColor = 'text-green-500';
                if (comment.sentiment === 'negative') sentimentColor = 'text-red-500';

                const commentEl = document.createElement('div');
                commentEl.className = 'border-b pb-3';
                commentEl.innerHTML = `
                    <p class="text-gray-800 text-sm">${comment.text}</p>
                    <div class="flex justify-between items-center mt-1">
                        <span class="text-xs ${sentimentColor} font-medium">${comment.sentiment === 'positive' ? 'ポジティブ' : (comment.sentiment === 'negative' ? 'ネガティブ' : '')}</span>
                        <span class="text-xs text-gray-500">${comment.user} (Q11, Q12)</span>
                    </div>
                `;
                commentListEl.appendChild(commentEl);
            });
        }

        // --- 作品個別分析カードの更新 ---
        function updateWorkIndividualCards(workData) {
            // プレースホルダーやカードの表示/非表示は updateDashboard 側で制御
            if (!workData) return; // データがなければ何もしない

            // カードA (NPS)
            document.getElementById('work-nps-score').textContent = workData.nps.score.toFixed(1);
            workNpsChart.data.datasets[0].data = [
                workData.nps.promoter, workData.nps.passive, workData.nps.detractor
            ];
            workNpsChart.update();

            // カードB (リピート)
            const repeatHeatRate = workData.repeat_intent.must + workData.repeat_intent.format;
            document.getElementById('work-repeat-rate').textContent = repeatHeatRate.toFixed(1);
            workRepeatChart.data.datasets[0].data = [
                repeatHeatRate, workData.repeat_intent.maybe, workData.repeat_intent.no
            ];
            workRepeatChart.update();

            // カードC (コア層)
            workCoreChart.data.datasets[0].data = [
                workData.core_nps.core, workData.core_nps.light
            ];
            workCoreChart.update();

            // カードD (総合)
            document.getElementById('work-potential-rank').textContent = workData.potential_rank;
            document.getElementById('work-summary-word').textContent = workData.summary.word_of_mouth;
            document.getElementById('work-summary-repeat').textContent = workData.summary.repeat;
            document.getElementById('work-summary-core').textContent = workData.summary.core_support;
        }

        // --- 作品横並び比較テーブルの更新 ---
        function updateWorkComparisonTable(workAnalyticsData) {
            const rankingBody = document.getElementById('potential-ranking-body');
            rankingBody.innerHTML = ''; // クリア

            // ポテンシャルランク順でソート (仮。A+ > A > A- > B)
            const rankOrder = {"A+": 5, "A": 4, "A-": 3, "B": 2, "B-": 1, "C": 0};
            const sortedData = (workAnalyticsData || []).sort((a, b) => {
                return (rankOrder[b.potential_rank] || 0) - (rankOrder[a.potential_rank] || 0);
            });

            if (sortedData.length === 0) {
                rankingBody.innerHTML = `<tr><td colspan="5" class="px-4 py-4 text-sm text-gray-500 text-center">分析データがありません。</td></tr>`;
                return;
            }

            sortedData.forEach(work => {
                const row = document.createElement('tr');

                let rankColor = 'text-gray-800';
                if ((rankOrder[work.potential_rank] || 0) >= 4) rankColor = 'text-blue-600 font-bold';
                else if ((rankOrder[work.potential_rank] || 0) <= 1) rankColor = 'text-gray-500';

                row.innerHTML = `
                    <td class="px-4 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${work.name}</div>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-center">
                        <span class="text-sm ${work.nps >= 30.0 ? 'text-blue-600' : 'text-gray-600'}">${work.nps >= 0 ? '+' : ''}${work.nps.toFixed(1)}</span>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-center">
                        <span class="text-sm ${work.repeat_heat >= 40.0 ? 'text-indigo-600' : 'text-gray-600'}">${work.repeat_heat.toFixed(1)}%</span>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-center">
                        <span class="text-sm ${work.core_nps >= 50.0 ? 'text-green-600' : 'text-gray-600'}">${work.core_nps >= 0 ? '+' : ''}${work.core_nps.toFixed(1)}</span>
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap">
                        <span class="text-sm ${rankColor} font-semibold">${work.potential_rank}</span>
                        <span class="text-xs text-gray-700 ml-2">${work.comment}</span>
                    </td>
                `;
                rankingBody.appendChild(row);
            });
        }


        // --- フィルター連動のダッシュボード更新 ---
        function updateDashboard() {
            selectedCineplex = document.getElementById('cineplex-filter').value;
            selectedBenchmark = document.getElementById('benchmark-filter').value;
            selectedPeriod = document.getElementById('period-filter').value;
            selectedWork = document.getElementById('work-filter').value; // ★ 作品フィルター取得

            const displayData = mockData[selectedCineplex][selectedPeriod] || mockData[selectedCineplex]['weekly'];
            const cineplexData = mockData[selectedCineplex];

            // --- 比較あり/なしの処理 ---
            const benchmarkContainer = document.getElementById('benchmark-score-container');
            const benchmarkLabel = benchmarkContainer.querySelector('span');

            if (selectedBenchmark === 'none' || !mockData.benchmark[selectedBenchmark]) {
                benchmarkContainer.style.display = 'none';
                evaluationChart.data.datasets = [{
                    label: cineplexData.name || '選択シネコン',
                    data: cineplexData.evaluation,
                    backgroundColor: '#0D9488', borderRadius: 4,
                }];
            } else {
                benchmarkContainer.style.display = 'block';
                const benchmarkData = mockData.benchmark[selectedBenchmark];

                benchmarkLabel.textContent = selectedBenchmark === 'industry' ? '業界平均:' : '自社平均:';
                document.getElementById('benchmark-score-value').textContent = benchmarkData.score.toFixed(1);

                evaluationChart.data.datasets = [
                    {
                        label: cineplexData.name || '選択シネコン',
                        data: cineplexData.evaluation,
                        backgroundColor: '#0D9488', borderRadius: 4,
                    },
                    {
                        label: selectedBenchmark === 'industry' ? '業界平均' : '自社平均',
                        data: benchmarkData.evaluation,
                        backgroundColor: '#99F6E4', borderRadius: 4,
                    }
                ];
            }
            document.getElementById('company-score-value').textContent = mockData.benchmark.company.score.toFixed(1);


            // --- 全モード共通の更新 ---

            // カード1 (総合満足度)
            document.getElementById('main-score-value').textContent = displayData.score.toFixed(1);
            updateTrendIndicator('score-vs-yesterday', displayData.score_vs_yesterday);
            updateTrendIndicator('score-vs-lastweek', displayData.score_vs_lastweek);

            // カード2 (NPS)
            document.getElementById('nps-score-value').textContent = displayData.nps.score.toFixed(1);
            updateTrendIndicator('nps-vs-yesterday', displayData.nps.vs_yesterday);
            updateTrendIndicator('nps-vs-lastweek', displayData.nps.vs_lastweek);
            npsTheaterChart.data.datasets[0].data = [
                displayData.nps.promoter,
                displayData.nps.passive,
                displayData.nps.detractor
            ];

            // カード3 (ランキング)
            rankingChart.data.labels = ['Bシネマ', 'Aシネマ', 'Cシネコン', 'Dシネコン'];
            rankingChart.data.datasets[0].data = [
                (mockData.cineplexB[selectedPeriod] || mockData.cineplexB.weekly).score,
                (mockData.cineplexA[selectedPeriod] || mockData.cineplexA.weekly).score,
                (mockData.cineplexC[selectedPeriod] || mockData.cineplexC.weekly).score,
                (mockData.cineplexD[selectedPeriod] || mockData.cineplexD.weekly).score,
            ];
            const cineplexIds = ['cineplexB', 'cineplexA', 'cineplexC', 'cineplexD'];
            rankingChart.data.datasets[0].backgroundColor = cineplexIds.map(id =>
                id === selectedCineplex ? '#4F46E5' : '#D1D5DB'
            );

            // カード4 (飲食)
            document.getElementById('concession-rate').innerHTML = `${displayData.concession.buy.toFixed(1)}<span class="text-3xl">%</span>`;
            updateTrendIndicator('concession-vs-yesterday', displayData.concession.vs_yesterday, '%');
            updateTrendIndicator('concession-vs-lastweek', displayData.concession.vs_lastweek, '%');
            concessionChart.data.datasets[0].data = [displayData.concession.buy, displayData.concession.notBuy];

            // カード5 (リピート)
            repeaterChart.data.datasets[0].data = [
                cineplexData.repeater.first,
                cineplexData.repeater.second,
                cineplexData.repeater.thirdOver
            ];

            // カード6 (頻度)
            frequencyChart.data.datasets[0].data = cineplexData.frequency;

            // カード7 (チケット)
            ticketChart.data.datasets[0].data = cineplexData.ticket;

            // カード8 (高評価) - データセットは「比較あり/なし」で処理済み

            // カード9 (プロフィール) [変更]
            profileChart.data.labels = cineplexData.profile.labels;
            profileChart.data.datasets[0].data = cineplexData.profile.data;
            profileChart.data.datasets[0].backgroundColor = cineplexData.profile.colors;

            // カード10 (重視要素)
            emphasisChart.data.datasets[0].data = cineplexData.emphasis;

            // カード11 (ご意見)
            updateCommentList();

            // 新規カード (休眠・新規)
            dormantChart.data.datasets[0].data = [
                cineplexData.dormant.new,
                cineplexData.dormant.comeback_3y,
                cineplexData.dormant.comeback_1y,
                cineplexData.dormant.active
            ];

            // 新規カード (おひとりさま)
            soloChart.data.datasets[0].data = [
                cineplexData.solo.solo,
                cineplexData.solo.multiple
            ];

            // --- ↓↓↓ 新規: 作品ポテンシャルセクションの更新 (分岐ロジック) ↓↓↓ ---
            const comparisonTable = document.getElementById('potential-ranking-table');
            const individualCardsContainer = document.getElementById('work-potential-cards-container');
            const placeholder = document.getElementById('work-potential-placeholder');
            const individualCards = [ // 個別カードのID
                document.getElementById('card-work-nps'),
                document.getElementById('card-work-repeat'),
                document.getElementById('card-work-core'),
                document.getElementById('card-work-potential')
            ];

            if (selectedWork === 'all') {
                // [横並び比較] を表示
                comparisonTable.classList.remove('hidden');
                individualCardsContainer.classList.add('hidden'); // 個別カードコンテナを隠す
                placeholder.classList.add('hidden');
                individualCards.forEach(card => card.classList.add('hidden'));

                updateWorkComparisonTable(cineplexData.work_analytics || []);

            } else {
                // [個別分析] を表示
                comparisonTable.classList.add('hidden');
                individualCardsContainer.classList.remove('hidden'); // 個別カードコンテナを表示

                const workData = cineplexData.works[selectedWork];
                if (workData) {
                    placeholder.classList.add('hidden');
                    individualCards.forEach(card => card.classList.remove('hidden'));
                    updateWorkIndividualCards(workData); // 個別カードのデータ更新
                } else {
                    // 作品データが存在しない場合
                    placeholder.classList.remove('hidden');
                    individualCards.forEach(card => card.classList.add('hidden'));
                }
            }


            // 全チャートを更新
            rankingChart.update();
            npsTheaterChart.update();
            concessionChart.update();
            repeaterChart.update();
            frequencyChart.update();
            ticketChart.update();
            evaluationChart.update();
            profileChart.update();
            emphasisChart.update();
            dormantChart.update();
            soloChart.update();
        }

        // ページ読み込み完了時
        window.onload = () => {
            initCharts();
            updateDashboard(); // 初期描画

            // フィルターにイベントリスナーを設定
            document.getElementById('cineplex-filter').addEventListener('change', updateDashboard);
            document.getElementById('benchmark-filter').addEventListener('change', updateDashboard);
            document.getElementById('period-filter').addEventListener('change', updateDashboard);
            document.getElementById('work-filter').addEventListener('change', updateDashboard); // ★ 作品フィルターリスナー

            // コメントフィルターのイベントリスナー
            const sentimentButtons = [
                document.getElementById('comment-filter-all'),
                document.getElementById('comment-filter-posi'),
                document.getElementById('comment-filter-nega')
            ];
            sentimentButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    sentimentButtons.forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentCommentSentiment = e.target.id.split('-')[2]; // 'all', 'posi', 'nega'
                    if (currentCommentSentiment === 'posi') currentCommentSentiment = 'positive';
                    if (currentCommentSentiment === 'nega') currentCommentSentiment = 'negative';
                    updateCommentList();
                });
            });

            document.getElementById('comment-keyword-filter').addEventListener('change', (e) => {
                currentCommentKeyword = e.target.value;
                updateCommentList();
            });
        };
    </script>

</body>
</html>
